#include "conv_block2.h"

/* 卷积层权重 [16][8][1][5] - 分组卷积 */
float conv2_weights[CONV2_OUT_CHANNELS][CONV2_GROUP_SIZE][CONV2_KERNEL_HEIGHT][CONV2_KERNEL_WIDTH] = {
    { /* 输出通道 0: 连接输入通道 0-7 */
        { /* 组内输入 0 (实际通道 0) */
            {0.10069884f, 0.65653163f, -0.26892322f, -0.01091834f, -0.00578028f}
        },
        { /* 组内输入 1 (实际通道 1) */
            {-0.00174326f, 0.11662081f, -0.78701001f, 0.15718760f, -0.09649897f}
        },
        { /* 组内输入 2 (实际通道 2) */
            {-0.18465900f, 0.25641835f, 0.47569016f, -0.22469971f, 0.05161859f}
        },
        { /* 组内输入 3 (实际通道 3) */
            {-0.67758578f, -1.80959666f, 1.45449829f, -0.68611580f, -0.43730983f}
        },
        { /* 组内输入 4 (实际通道 4) */
            {0.04822626f, 0.19049329f, 0.10977467f, -0.15008447f, -0.07826646f}
        },
        { /* 组内输入 5 (实际通道 5) */
            {-0.32687280f, 0.35897452f, 0.26647910f, 0.30840337f, 0.07997052f}
        },
        { /* 组内输入 6 (实际通道 6) */
            {-0.24455900f, -0.20020600f, -0.39810342f, -0.08493707f, -0.38504344f}
        },
        { /* 组内输入 7 (实际通道 7) */
            {0.36934692f, -0.56695569f, 0.12132250f, -1.21983552f, -0.07189573f}
        }
    },
    { /* 输出通道 1: 连接输入通道 0-7 */
        { /* 组内输入 0 (实际通道 0) */
            {0.03738400f, -0.22412510f, 0.16704194f, -0.03356053f, -0.14864771f}
        },
        { /* 组内输入 1 (实际通道 1) */
            {-0.03232415f, -0.38204974f, -0.03023409f, 0.18972987f, -0.02121683f}
        },
        { /* 组内输入 2 (实际通道 2) */
            {0.01409074f, 0.40751949f, -0.52334976f, 0.29125389f, 0.34667915f}
        },
        { /* 组内输入 3 (实际通道 3) */
            {0.11055966f, -0.37754041f, -0.12735423f, -0.34466755f, -0.96607864f}
        },
        { /* 组内输入 4 (实际通道 4) */
            {0.26676708f, -0.28369772f, -0.21746245f, -0.06219149f, -0.37103301f}
        },
        { /* 组内输入 5 (实际通道 5) */
            {-0.33702493f, 0.50742280f, 0.63580304f, -0.16420393f, 0.15377128f}
        },
        { /* 组内输入 6 (实际通道 6) */
            {0.06139537f, -0.50589824f, 0.30515638f, -0.06584762f, -0.76341414f}
        },
        { /* 组内输入 7 (实际通道 7) */
            {-0.23877530f, -0.21782994f, -1.23360825f, -0.04964371f, -0.38553452f}
        }
    },
    { /* 输出通道 2: 连接输入通道 0-7 */
        { /* 组内输入 0 (实际通道 0) */
            {-0.08234833f, 0.16086109f, -0.01947604f, 0.12100787f, 0.26753512f}
        },
        { /* 组内输入 1 (实际通道 1) */
            {0.37882951f, -0.00531098f, -0.45586088f, -0.05014363f, 0.15541686f}
        },
        { /* 组内输入 2 (实际通道 2) */
            {-0.11519200f, 0.20599145f, -0.66542673f, 0.56492782f, -0.26179969f}
        },
        { /* 组内输入 3 (实际通道 3) */
            {0.76702160f, 0.30453849f, 0.32057354f, -0.22574739f, -1.38517046f}
        },
        { /* 组内输入 4 (实际通道 4) */
            {0.02957370f, -0.35221264f, 0.74671727f, -0.15597375f, -0.12093646f}
        },
        { /* 组内输入 5 (实际通道 5) */
            {-0.00293482f, 0.39489269f, -0.74167830f, 0.22304505f, 0.06238241f}
        },
        { /* 组内输入 6 (实际通道 6) */
            {0.03664834f, -0.26796889f, -0.14710350f, -1.06180573f, 0.05904803f}
        },
        { /* 组内输入 7 (实际通道 7) */
            {-0.03529258f, -0.97044653f, 0.16598065f, -0.31440410f, -0.39588195f}
        }
    },
    { /* 输出通道 3: 连接输入通道 0-7 */
        { /* 组内输入 0 (实际通道 0) */
            {0.22128025f, 0.07667293f, -0.01578329f, -0.33653936f, -0.03026280f}
        },
        { /* 组内输入 1 (实际通道 1) */
            {0.03386843f, -0.11614846f, 0.12122478f, 0.15496381f, -0.03866319f}
        },
        { /* 组内输入 2 (实际通道 2) */
            {0.03096187f, -0.24003337f, 0.25603515f, 0.10969386f, 0.19463290f}
        },
        { /* 组内输入 3 (实际通道 3) */
            {-1.21707094f, -1.89894748f, 0.47225156f, -0.39625132f, -2.33866072f}
        },
        { /* 组内输入 4 (实际通道 4) */
            {-0.33044356f, 0.39857322f, 0.64408636f, -0.16557604f, -0.61573732f}
        },
        { /* 组内输入 5 (实际通道 5) */
            {-0.19610249f, 0.04795443f, 0.23886280f, -0.26266795f, 0.03555963f}
        },
        { /* 组内输入 6 (实际通道 6) */
            {0.05671376f, 0.23389481f, -0.82354361f, 0.23608191f, -0.57602334f}
        },
        { /* 组内输入 7 (实际通道 7) */
            {-0.03577350f, -0.87264782f, -0.08059992f, -0.31730723f, -1.24361467f}
        }
    },
    { /* 输出通道 4: 连接输入通道 0-7 */
        { /* 组内输入 0 (实际通道 0) */
            {0.41893831f, -0.12232081f, 0.09241245f, -0.27400604f, -0.39982533f}
        },
        { /* 组内输入 1 (实际通道 1) */
            {0.33479449f, -0.19259410f, 0.26921749f, 0.12053249f, -0.31872365f}
        },
        { /* 组内输入 2 (实际通道 2) */
            {-0.16551208f, 0.06095168f, 0.23634142f, -0.17786132f, -0.10776800f}
        },
        { /* 组内输入 3 (实际通道 3) */
            {0.91781276f, -0.07050297f, -0.31961975f, -0.22456996f, -0.84158033f}
        },
        { /* 组内输入 4 (实际通道 4) */
            {0.61481977f, -0.30806684f, 0.07648733f, 0.19743297f, -0.08527076f}
        },
        { /* 组内输入 5 (实际通道 5) */
            {0.32486078f, -0.45203510f, 0.41172951f, -0.08429860f, -0.22556517f}
        },
        { /* 组内输入 6 (实际通道 6) */
            {-0.63003433f, -1.31927335f, -0.06418473f, 0.18737538f, 0.01474256f}
        },
        { /* 组内输入 7 (实际通道 7) */
            {-1.18101728f, -0.37482736f, -0.34063348f, -0.02825797f, 0.02293424f}
        }
    },
    { /* 输出通道 5: 连接输入通道 0-7 */
        { /* 组内输入 0 (实际通道 0) */
            {-0.06158620f, 0.47540236f, 1.50602174f, 0.04220819f, 0.03424915f}
        },
        { /* 组内输入 1 (实际通道 1) */
            {0.05783455f, -0.11940973f, 0.78766912f, -0.11537167f, 0.02973883f}
        },
        { /* 组内输入 2 (实际通道 2) */
            {-0.18919034f, -0.07473815f, 1.95417714f, 0.52503932f, -0.14657913f}
        },
        { /* 组内输入 3 (实际通道 3) */
            {-0.76140469f, -1.31017935f, -0.84965134f, -0.06960997f, 0.39220670f}
        },
        { /* 组内输入 4 (实际通道 4) */
            {0.22945689f, 0.34128112f, 0.64476901f, -0.12831587f, -0.04841221f}
        },
        { /* 组内输入 5 (实际通道 5) */
            {-0.17155829f, 1.05937564f, 1.23653388f, 0.25433496f, -0.35285738f}
        },
        { /* 组内输入 6 (实际通道 6) */
            {-0.13739431f, -0.08153160f, 0.31388909f, 0.04376414f, -0.00990110f}
        },
        { /* 组内输入 7 (实际通道 7) */
            {-0.19283338f, 0.01299062f, 0.78341740f, 0.01994926f, 0.03510064f}
        }
    },
    { /* 输出通道 6: 连接输入通道 0-7 */
        { /* 组内输入 0 (实际通道 0) */
            {0.26536754f, -0.67059988f, 0.06089794f, 0.57032418f, 0.11272980f}
        },
        { /* 组内输入 1 (实际通道 1) */
            {0.36311093f, -0.52066213f, -0.27504668f, 0.03222615f, 0.08747405f}
        },
        { /* 组内输入 2 (实际通道 2) */
            {-0.31237918f, -0.20469099f, 0.39702937f, -0.30238247f, -0.18756159f}
        },
        { /* 组内输入 3 (实际通道 3) */
            {-0.58629990f, -0.25823006f, 0.94002038f, -0.65134841f, 0.36490631f}
        },
        { /* 组内输入 4 (实际通道 4) */
            {0.09399850f, 0.11984175f, -0.18218388f, -0.04874931f, 0.49478680f}
        },
        { /* 组内输入 5 (实际通道 5) */
            {0.01137730f, -0.17316137f, 0.26063460f, 0.66434520f, -0.19375999f}
        },
        { /* 组内输入 6 (实际通道 6) */
            {-0.03196027f, -0.44359723f, -0.71295786f, -0.05711179f, 0.08860859f}
        },
        { /* 组内输入 7 (实际通道 7) */
            {-0.58252525f, 0.27744156f, -0.08750039f, -0.82549965f, -0.07529730f}
        }
    },
    { /* 输出通道 7: 连接输入通道 0-7 */
        { /* 组内输入 0 (实际通道 0) */
            {-0.05222809f, 0.01814503f, -0.51781839f, 0.51153731f, -0.49120983f}
        },
        { /* 组内输入 1 (实际通道 1) */
            {0.11725017f, 0.23125181f, -0.04464360f, 0.94525498f, -0.24286336f}
        },
        { /* 组内输入 2 (实际通道 2) */
            {-0.01313551f, -0.07686128f, -0.18381362f, 0.50687325f, -0.04458525f}
        },
        { /* 组内输入 3 (实际通道 3) */
            {-0.78068787f, -0.87612218f, 0.69095147f, -0.29409257f, -0.12717609f}
        },
        { /* 组内输入 4 (实际通道 4) */
            {-0.14436162f, -0.26915103f, 0.39466891f, 0.14908034f, -0.73615336f}
        },
        { /* 组内输入 5 (实际通道 5) */
            {-0.24416140f, -0.11080734f, 0.13154076f, 0.21067071f, 0.16670066f}
        },
        { /* 组内输入 6 (实际通道 6) */
            {-0.07565362f, -0.03792590f, -0.15242887f, -0.91468191f, -0.47672436f}
        },
        { /* 组内输入 7 (实际通道 7) */
            {0.06961972f, 0.05849948f, -0.36117616f, -1.05234683f, 0.00415515f}
        }
    },
    { /* 输出通道 8: 连接输入通道 8-15 */
        { /* 组内输入 0 (实际通道 8) */
            {-0.17063101f, -0.05660848f, 1.10834217f, -0.76911068f, 0.12873399f}
        },
        { /* 组内输入 1 (实际通道 9) */
            {0.17748424f, -0.25403044f, -0.84531081f, 0.12467378f, -0.22596331f}
        },
        { /* 组内输入 2 (实际通道 10) */
            {0.03842361f, -0.01575366f, -0.08608074f, -0.00432736f, -0.12608591f}
        },
        { /* 组内输入 3 (实际通道 11) */
            {-0.01464062f, -0.08997072f, -0.17621608f, 0.36692029f, 0.52279222f}
        },
        { /* 组内输入 4 (实际通道 12) */
            {0.61110187f, -0.01593376f, 0.37453753f, 0.25436047f, 0.13183154f}
        },
        { /* 组内输入 5 (实际通道 13) */
            {-0.05030087f, 0.05383161f, 0.09343912f, -0.48780391f, 0.05045881f}
        },
        { /* 组内输入 6 (实际通道 14) */
            {0.06931620f, -0.33202365f, 0.19844598f, 0.14941812f, 0.86143517f}
        },
        { /* 组内输入 7 (实际通道 15) */
            {-0.05041128f, -0.05812306f, -0.59315151f, -0.21911879f, 0.15108980f}
        }
    },
    { /* 输出通道 9: 连接输入通道 8-15 */
        { /* 组内输入 0 (实际通道 8) */
            {-0.01446519f, 0.36991224f, 0.48734862f, 0.17113456f, -0.02515609f}
        },
        { /* 组内输入 1 (实际通道 9) */
            {0.07813331f, -0.46600717f, -0.49895820f, 0.05326920f, -0.06367741f}
        },
        { /* 组内输入 2 (实际通道 10) */
            {-0.14417525f, 0.87810105f, 0.24237709f, 0.09594070f, -0.26166558f}
        },
        { /* 组内输入 3 (实际通道 11) */
            {-0.84006447f, 0.08997560f, 0.82655096f, 0.22171707f, -0.67192239f}
        },
        { /* 组内输入 4 (实际通道 12) */
            {0.31976405f, -0.39635676f, 1.43402338f, 0.29843211f, -0.15961145f}
        },
        { /* 组内输入 5 (实际通道 13) */
            {0.00121109f, 0.51519209f, 0.24949974f, 0.12678677f, -0.03316392f}
        },
        { /* 组内输入 6 (实际通道 14) */
            {0.14809379f, -1.43869698f, 0.73236442f, -0.20593983f, -0.51783317f}
        },
        { /* 组内输入 7 (实际通道 15) */
            {0.02676027f, -0.59198159f, -0.08982560f, -0.03643711f, -0.05284734f}
        }
    },
    { /* 输出通道 10: 连接输入通道 8-15 */
        { /* 组内输入 0 (实际通道 8) */
            {-0.23628463f, 0.94426113f, -0.65515715f, 1.15972388f, 0.09276179f}
        },
        { /* 组内输入 1 (实际通道 9) */
            {0.10001517f, -0.20342314f, 0.25632933f, -0.78325546f, -0.03514085f}
        },
        { /* 组内输入 2 (实际通道 10) */
            {-0.13651589f, 0.38480416f, 0.16293775f, -0.10221494f, 0.20029028f}
        },
        { /* 组内输入 3 (实际通道 11) */
            {0.55563116f, 0.01253732f, 0.88113123f, -0.76552117f, -0.34215924f}
        },
        { /* 组内输入 4 (实际通道 12) */
            {0.96049458f, 0.45005065f, 0.09184944f, 0.32623798f, -0.03894715f}
        },
        { /* 组内输入 5 (实际通道 13) */
            {-0.04178412f, -0.01603189f, -0.09082010f, 0.15145025f, 0.16600655f}
        },
        { /* 组内输入 6 (实际通道 14) */
            {0.27419576f, 0.67087144f, -0.17567731f, 0.38258526f, 1.95615530f}
        },
        { /* 组内输入 7 (实际通道 15) */
            {0.14653742f, -0.18816634f, 0.01253649f, 0.04675888f, 0.08099514f}
        }
    },
    { /* 输出通道 11: 连接输入通道 8-15 */
        { /* 组内输入 0 (实际通道 8) */
            {0.14122340f, -0.80870295f, 0.49468818f, 0.65569103f, -0.26008919f}
        },
        { /* 组内输入 1 (实际通道 9) */
            {0.00787108f, -0.07098126f, -0.42325699f, -0.40597430f, 0.10660745f}
        },
        { /* 组内输入 2 (实际通道 10) */
            {0.15787081f, -0.36594376f, 1.14821076f, -0.05971994f, 0.08992270f}
        },
        { /* 组内输入 3 (实际通道 11) */
            {0.02445259f, 0.48510742f, 0.19373277f, -0.26702118f, -0.05228044f}
        },
        { /* 组内输入 4 (实际通道 12) */
            {-0.03662734f, 0.51826769f, 0.17642425f, 0.27671295f, -0.02206646f}
        },
        { /* 组内输入 5 (实际通道 13) */
            {0.15969555f, -0.54775321f, 0.80870360f, 0.68665034f, -0.16684966f}
        },
        { /* 组内输入 6 (实际通道 14) */
            {0.05010216f, 0.44346410f, 0.00912359f, 0.02964350f, 0.13550033f}
        },
        { /* 组内输入 7 (实际通道 15) */
            {-0.17517626f, 0.17322591f, -0.72339195f, 0.26084787f, 0.10575581f}
        }
    },
    { /* 输出通道 12: 连接输入通道 8-15 */
        { /* 组内输入 0 (实际通道 8) */
            {0.19015677f, -0.67511714f, -1.42565727f, -0.48598519f, 0.58525735f}
        },
        { /* 组内输入 1 (实际通道 9) */
            {0.20821700f, 0.50065899f, 0.22344844f, 0.14562872f, -0.36002260f}
        },
        { /* 组内输入 2 (实际通道 10) */
            {-0.06240999f, -0.30841932f, -0.66875100f, 0.26417994f, -0.09970784f}
        },
        { /* 组内输入 3 (实际通道 11) */
            {0.50576603f, 0.19992076f, -1.15027487f, -0.00039561f, 0.20616384f}
        },
        { /* 组内输入 4 (实际通道 12) */
            {0.56518221f, 0.34857124f, -0.76400340f, -0.30295834f, -0.06732619f}
        },
        { /* 组内输入 5 (实际通道 13) */
            {0.06552928f, 0.06652700f, -0.32864815f, -0.08297206f, 0.05973135f}
        },
        { /* 组内输入 6 (实际通道 14) */
            {-0.41612571f, 0.46970367f, 0.33980981f, 0.06332281f, 0.29440090f}
        },
        { /* 组内输入 7 (实际通道 15) */
            {0.10683516f, 0.22580130f, 0.20870441f, -0.17266482f, 0.04044369f}
        }
    },
    { /* 输出通道 13: 连接输入通道 8-15 */
        { /* 组内输入 0 (实际通道 8) */
            {-0.00868729f, -0.08710115f, 0.94023514f, -0.79965121f, 0.05080257f}
        },
        { /* 组内输入 1 (实际通道 9) */
            {-0.01270855f, -0.10868604f, -0.60671103f, 0.46875146f, -0.28922564f}
        },
        { /* 组内输入 2 (实际通道 10) */
            {-0.20165055f, 0.51633942f, 0.03982460f, -0.14208837f, -0.01534438f}
        },
        { /* 组内输入 3 (实际通道 11) */
            {-0.07143331f, 2.09284425f, 0.33444929f, 0.03750264f, 0.04045530f}
        },
        { /* 组内输入 4 (实际通道 12) */
            {-0.28733683f, -0.00327754f, 1.25284505f, 0.18995999f, -0.58221656f}
        },
        { /* 组内输入 5 (实际通道 13) */
            {-0.14238963f, 0.21609710f, 0.24308206f, -0.10866792f, -0.10981236f}
        },
        { /* 组内输入 6 (实际通道 14) */
            {1.50793862f, -0.03900760f, 0.05430717f, -0.24720371f, -0.73526233f}
        },
        { /* 组内输入 7 (实际通道 15) */
            {0.00575485f, -0.00663225f, 0.17891034f, -0.07335591f, -0.00903148f}
        }
    },
    { /* 输出通道 14: 连接输入通道 8-15 */
        { /* 组内输入 0 (实际通道 8) */
            {-0.22616319f, -0.44594112f, -0.02956901f, 1.22380435f, 0.48296386f}
        },
        { /* 组内输入 1 (实际通道 9) */
            {0.05311530f, -0.27430186f, -0.05010901f, 0.36115766f, 0.12501487f}
        },
        { /* 组内输入 2 (实际通道 10) */
            {-0.19072582f, 0.12432402f, 0.09273976f, 0.62599355f, 0.16276442f}
        },
        { /* 组内输入 3 (实际通道 11) */
            {0.64808577f, 0.30188096f, -0.01495632f, 0.44496873f, -0.05427105f}
        },
        { /* 组内输入 4 (实际通道 12) */
            {-1.23773479f, -0.21043818f, 0.31335250f, 0.01186596f, -0.56659847f}
        },
        { /* 组内输入 5 (实际通道 13) */
            {0.69560868f, -0.62723833f, 1.02631652f, 0.25744897f, -0.03847573f}
        },
        { /* 组内输入 6 (实际通道 14) */
            {0.44032678f, 0.03294869f, 0.28708914f, -0.02673354f, -1.76167560f}
        },
        { /* 组内输入 7 (实际通道 15) */
            {0.07310583f, 0.06166981f, -0.02236863f, -0.17065026f, 0.02143800f}
        }
    },
    { /* 输出通道 15: 连接输入通道 8-15 */
        { /* 组内输入 0 (实际通道 8) */
            {-0.29539466f, -0.03061124f, 1.03145707f, 0.40000173f, -0.15628165f}
        },
        { /* 组内输入 1 (实际通道 9) */
            {0.08124298f, -0.63356435f, -0.65593714f, -0.14184003f, -0.12964328f}
        },
        { /* 组内输入 2 (实际通道 10) */
            {-0.03903531f, -0.10331825f, 0.55316097f, 0.28698009f, -0.02111840f}
        },
        { /* 组内输入 3 (实际通道 11) */
            {0.05368540f, 0.17959991f, 0.50711191f, -0.16309933f, 0.09654940f}
        },
        { /* 组内输入 4 (实际通道 12) */
            {0.73250246f, 0.40378892f, 1.07774675f, 0.60045260f, 0.54136163f}
        },
        { /* 组内输入 5 (实际通道 13) */
            {0.02126807f, -0.28707802f, -0.11163508f, 0.09444386f, 0.04395045f}
        },
        { /* 组内输入 6 (实际通道 14) */
            {0.26563054f, -0.22644000f, 0.27899384f, 0.05511350f, 0.69410813f}
        },
        { /* 组内输入 7 (实际通道 15) */
            {-0.31684130f, -0.48018825f, -0.42820528f, -0.09267359f, -0.07316540f}
        }
    }
};

/* 卷积层偏置 */
float conv2_bias[CONV2_OUT_CHANNELS] = {
    -0.16241960f, -0.12485739f, 0.24230455f, 0.11094414f,
    -0.17567198f, -0.15359315f, 0.39614153f, -0.46520180f,
    0.10922725f, -0.11627575f, -0.11761577f, -0.06204865f,
    -0.09243030f, -0.75444794f, -0.13690548f, 0.99762481f
};

/* BatchNorm参数 */
float bn2_weight[CONV2_OUT_CHANNELS] = {
    0.43069622f, 0.33221126f, 0.33015236f, 0.37559298f,
    0.24022834f, 0.74503267f, 0.32685012f, 0.32877922f,
    0.22469680f, 0.35190722f, 0.51462263f, 0.38243201f,
    0.24818163f, 0.56767023f, 0.31011087f, 0.39370021f
};

float bn2_bias[CONV2_OUT_CHANNELS] = {
    -0.09705638f, 0.21436024f, 0.26492095f, 0.56398267f,
    0.50452167f, -0.41546780f, 0.34038055f, 1.16799569f,
    -0.42238373f, 1.13165319f, -0.30989990f, 1.17734683f,
    0.42222360f, 0.21022972f, -0.22769615f, -0.12256197f
};

float bn2_mean[CONV2_OUT_CHANNELS] = {
    -0.38389602f, -0.35908860f, -0.02040379f, 0.07261270f,
    -0.48901808f, 0.42346209f, 0.08291617f, -0.53638083f,
    0.01845523f, 0.06039800f, -0.18665136f, -0.03296181f,
    -0.27352557f, -0.85703790f, 0.01345734f, 0.96920317f
};

float bn2_var[CONV2_OUT_CHANNELS] = {
    0.02206891f, 0.01824638f, 0.02236598f, 0.02834990f,
    0.04037009f, 0.11223136f, 0.01215313f, 0.03527310f,
    0.00260866f, 0.00950645f, 0.00427562f, 0.00897560f,
    0.00755197f, 0.00303134f, 0.00723853f, 0.00816249f
};

/* 预计算的 1/sqrt(var+eps) - 用于优化 */
float bn2_inv_std[CONV2_OUT_CHANNELS] = {
    6.72993946f, 7.40103865f, 6.68511581f, 5.93810177f,
    4.97641277f, 2.98485708f, 9.06728745f, 5.32373762f,
    19.54162979f, 10.25091171f, 15.27542400f, 10.54936600f,
    11.49959373f, 18.13291740f, 11.74559689f, 11.06172276f
};

/* PReLU参数 */
float prelu_alpha2 = 0.27262056f;

void calc_conv2(float(*input)[CONV2_INPUT_FREQ], float(*output)[CONV2_OUTPUT_FREQ])
{
	int cout, f_out, channel;
	int counter1 = -2, counter2 = -2;
	float bias;
	float bn_w;
	float bn_b;
	float bn_m;
	float inv_std;
	float sum;
	float w0, w1, w2, w3, w4;
	float x0, x1, x2, x3, x4;
	float bn_result;
    int base;
	for (cout = 0; cout < CONV2_GROUP_SIZE; cout++)
	{
		bias = conv2_bias[cout];
		bn_w = bn2_weight[cout];
		bn_b = bn2_bias[cout];
		bn_m = bn2_mean[cout];
		// float bn_v = bn_var[cout];
		// float inv_std = 1.0f / sqrtf(bn_v + BN_EPS);
		inv_std = bn2_inv_std[cout];

		for (f_out = 0; f_out < CONV2_OUTPUT_FREQ; f_out++)
		{
			sum = bias;

			for (channel = 0; channel < CONV2_GROUP_SIZE; channel++)
			{
				float* weight_row = &conv2_weights[cout][channel][0][0];

				w0 = weight_row[0];
				w1 = weight_row[1];
				w2 = weight_row[2];
				w3 = weight_row[3];
				w4 = weight_row[4];

                base = counter1;
                /*
				if (counter1 < 0)
				{
					x0 = 0.0f;
					x1 = 0.0f;
					x2 = input[channel][counter1 + 2];
					x3 = input[channel][counter1 + 3];
					x4 = input[channel][counter1 + 4];
				}
				else if ((counter1 + 2) >= 64)
				{
					x0 = input[channel][counter1];
					x1 = input[channel][counter1 + 1];
					x2 = input[channel][counter1 + 2];
					x3 = 0.0f;
					x4 = 0.0f;
				}
				else
				{
					x0 = input[channel][counter1];
					x1 = input[channel][counter1 + 1];
					x2 = input[channel][counter1 + 2];
					x3 = input[channel][counter1 + 3];
					x4 = input[channel][counter1 + 4];
				}
                */

                x0 = (base + 0 >= 0 && base + 0 < CONV2_INPUT_FREQ) ? input[channel][base + 0] : 0.0f;
                x1 = (base + 1 >= 0 && base + 1 < CONV2_INPUT_FREQ) ? input[channel][base + 1] : 0.0f;
                x2 = (base + 2 >= 0 && base + 2 < CONV2_INPUT_FREQ) ? input[channel][base + 2] : 0.0f;
                x3 = (base + 3 >= 0 && base + 3 < CONV2_INPUT_FREQ) ? input[channel][base + 3] : 0.0f;
                x4 = (base + 4 >= 0 && base + 4 < CONV2_INPUT_FREQ) ? input[channel][base + 4] : 0.0f;

				sum += x0 * w0 + x1 * w1 + x2 * w2 + x3 * w3 + x4 * w4;
			}

			// batch norm + prelu
			bn_result = (sum - bn_m) * inv_std * bn_w + bn_b;

			if (bn_result >= 0.0f)
			{
				output[cout][f_out] = bn_result;
			}
			else
			{
				output[cout][f_out] = bn_result * prelu_alpha2;
			}
			counter1 += CONV2_STRIDE;
		}
		counter1 = -2;
	}

	for (cout = CONV2_GROUP_SIZE; cout < CONV2_OUT_CHANNELS; cout++)
	{
		bias = conv2_bias[cout];
		bn_w = bn2_weight[cout];
		bn_b = bn2_bias[cout];
		bn_m = bn2_mean[cout];
		// float bn_v = bn_var[cout];
		// float inv_std = 1.0f / sqrtf(bn_v + BN_EPS);
		inv_std = bn2_inv_std[cout];

		for (f_out = 0; f_out < CONV2_OUTPUT_FREQ; f_out++)
		{
			sum = bias;
			for (channel = 0; channel < CONV2_GROUP_SIZE; channel++)
			{
				float* weight_row = &conv2_weights[cout][channel][0][0];
                int ch = channel + 8;
                base = counter2;
				w0 = weight_row[0];
				w1 = weight_row[1];
				w2 = weight_row[2];
				w3 = weight_row[3];
				w4 = weight_row[4];

                /*
				if (counter2 < 0)
				{
					x0 = 0.0f;
					x1 = 0.0f;
					x2 = input[channel + 8][counter2 + 2];
					x3 = input[channel + 8][counter2 + 3];
					x4 = input[channel + 8][counter2 + 4];
				}
				else if ((counter2 + 2) >= 64)
				{
					x0 = input[channel + 8][counter2];
					x1 = input[channel + 8][counter2 + 1];
					x2 = input[channel + 8][counter2 + 2];
					x3 = 0.0f;
					x4 = 0.0f;
				}
				else
				{
					x0 = input[channel + 8][counter2];
					x1 = input[channel + 8][counter2 + 1];
					x2 = input[channel + 8][counter2 + 2];
					x3 = input[channel + 8][counter2 + 3];
					x4 = input[channel + 8][counter2 + 4];
				}
                */

                x0 = (base + 0 >= 0 && base + 0 < CONV2_INPUT_FREQ) ? input[ch][base + 0] : 0.0f;
                x1 = (base + 1 >= 0 && base + 1 < CONV2_INPUT_FREQ) ? input[ch][base + 1] : 0.0f;
                x2 = (base + 2 >= 0 && base + 2 < CONV2_INPUT_FREQ) ? input[ch][base + 2] : 0.0f;
                x3 = (base + 3 >= 0 && base + 3 < CONV2_INPUT_FREQ) ? input[ch][base + 3] : 0.0f;
                x4 = (base + 4 >= 0 && base + 4 < CONV2_INPUT_FREQ) ? input[ch][base + 4] : 0.0f;

				sum += x0 * w0 + x1 * w1 + x2 * w2 + x3 * w3 + x4 * w4;
			}
			// batch norm + prelu
			bn_result = (sum - bn_m) * inv_std * bn_w + bn_b;

			if (bn_result >= 0.0f)
			{
				output[cout][f_out] = bn_result;
			}
			else
			{
				output[cout][f_out] = bn_result * prelu_alpha2;
			}
			counter2 += CONV2_STRIDE;
		}
		counter2 = -2;
	}
}
