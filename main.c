#pragma comment(lib, "D:\\Program Files\\Mega-Nerd\\libsndfile\\lib\\libsndfile-1.lib")
#define _CRT_SECURE_NO_WARNINGS
#include<stdio.h>
#include<stdlib.h>
#include<sndfile.h>
#include "denoise16k.h"

#define DEBUG_DENOISE 0

// debug用测试fft
float test_fft[HALF] = { 0.053766713f,0.18338850f,-0.22588469f,0.086217329f,0.031876523f,-0.13076884f,-0.043359201f,0.034262445f,0.35783970f,0.27694371f,-0.13498870f,0.30349234f,0.072540425f,-0.0063054874f,0.071474291f,-0.020496605f,-0.012414435f,0.14896975f,0.14090344f,0.14171924f,0.067149714f,-0.12074869f,0.071723863f,0.16302353f,0.048889376f,0.10346930f,0.072688513f,-0.030344093f,0.029387146f,-0.078728281f,0.088839561f,-0.11470701f,-0.10688704f,-0.080949873f,-0.29442841f,0.14383803f,0.032519054f,-0.075492829f,0.13702986f,-0.17115164f,-0.010224245f,-0.024144704f,0.031920675f,0.031285860f,-0.086487994f,-0.0030051295f,-0.016487902f,0.062770732f,0.10932656f,0.11092733f,-0.086365283f,0.0077359090f,-0.12141170f,-0.11135007f,-0.00068493281f,0.15326303f,-0.076966591f,0.037137881f,-0.022558440f,0.11173561f,-0.10890643f,0.0032557463f,0.055252701f,0.11006102f,0.15442120f,0.0085931132f,-0.14915903f,-0.074230187f,-0.10615817f,0.23504572f,-0.061560187f,0.074807681f,-0.019241851f,0.088861041f,-0.076484926f,-0.14022690f,-0.14223759f,0.048819389f,-0.017737515f,-0.019605348f,0.14193101f,0.029158438f,0.019781105f,0.15876991f,-0.080446593f,0.069662444f,0.083508819f,-0.024371514f,0.021567009f,-0.11658439f,-0.11479528f,0.010487472f,0.072225407f,0.25854912f,-0.066689067f,0.018733103f,-0.0082494421f,-0.19330229f,-0.043896616f,-0.17946789f,0.084037550f,-0.088803209f,0.010009283f,-0.054452892f,0.030352080f,-0.060032655f,0.048996530f,0.073936313f,0.17118877f,-0.019412354f,-0.21383552f,-0.083958872f,0.13545944f,-0.10721553f,0.096095391f,0.012404980f,0.14366966f,-0.19609000f,-0.019769823f,-0.12078455f,0.29080081f,0.082521893f,0.13789719f,-0.10581803f,-0.046861559f,-0.027246941f,0.10984246f,-0.027787194f,0.070154145f,-0.20518163f,-0.035385001f,-0.082358651f,-0.15770571f,0.050797466f,0.028198406f,0.0033479882f,-0.13336779f,0.11274923f,0.035017941f,-0.029906603f,0.0022889792f,-0.026199544f,-0.17502123f,-0.028565098f,-0.083136648f,-0.097920634f,-0.11564016f,-0.053355712f,-0.20026357f,0.096422940f,0.052006010f,-0.0020027852f,-0.0034771087f,-0.079816356f,0.10186853f,-0.013321748f,-0.071453020f,0.13513857f,-0.022477105f,-0.058902904f,-0.029375359f,-0.084792621f,-0.11201283f,0.25259995f,0.16554976f,0.030753516f,-0.12571184f,-0.086546801f,-0.017653411f,0.079141609f,-0.13320044f,-0.23298672f,-0.14490972f,0.033351082f,0.039135359f,0.045167942f,-0.013028465f,0.018368909f,-0.047615301f,0.086202160f,-0.13616945f,0.045502957f,-0.084870934f,-0.033488695f,0.055278335f,0.10390907f,-0.11176386f,0.12606587f,0.066014312f,-0.0067865555f,-0.019522119f,-0.021760635f,-0.030310763f,0.0023045624f,0.0051290356f,0.082606278f,0.15269767f,0.046691444f,-0.020971334f,0.062519036f,0.018322727f,-0.10297675f,0.094922185f,0.030706191f,0.013517494f,0.051524635f,0.026140632f,-0.094148576f,-0.016233766f,-0.014605463f,-0.053201139f,0.16821036f,-0.087572932f,-0.048381504f,-0.071200453f,-0.11742123f,-0.019223953f,-0.027407022f,0.15300725f,-0.024902474f,-0.10642134f,0.16034573f,0.12346791f,-0.022962645f,-0.15061598f,-0.044462781f,-0.015594103f,0.027606826f,-0.026116364f,0.044342190f,0.039189421f,-0.12506789f,-0.094796091f,-0.074110612f,-0.050781757f,-0.032057550f,0.0012469041f,-0.30291775f,-0.045701463f,0.12424484f,-0.10667014f,0.093372814f,0.035032101f,-0.0029005765f,0.018245216f,-0.15650560f,-0.0084539484f,0.16039464f,0.0098347776f,0.0041373614f,-0.073416911f,-0.0030813729f,0.023234701f,0.042638756f,-0.037280872f,-0.023645459f };

#if DEBUG_DENOISE
int main()
{
	float input_buffer[HALF];
	float output_buffer[HALF];

	const char* input_file = "noisy_audio.wav";
	const char* output_file = "enhanced_audio.wav";

	int i;
	int frame_read;

	printf("开始处理\n");
	printf("输入文件: %s\n", input_file);
	printf("输出文件: %s\n", output_file);
}
#else
// 逐帧测试用
int main()
{
	int i;
	init_para();
	float output[HALF];
	run_denoise(test_fft, output);
	
}
#endif
